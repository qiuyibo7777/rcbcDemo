Ext.define("Ext.ux.TreePicker",{extend:"Ext.form.field.Picker",xtype:"treepicker",triggerCls:Ext.baseCSSPrefix+"form-arrow-trigger",config:{store:null,displayField:null,columns:null,selectOnTab:true,maxPickerHeight:300,minPickerHeight:100},editable:false,initComponent:function(){var A=this;A.callParent(arguments);this.addEvents("select");A.store.on("load",A.onLoad,A)},createPicker:function(){var C=this,B=Ext.create("Ext.tree.Panel",{store:C.store,floating:true,hidden:true,displayField:C.displayField,columns:C.columns,useArrows:true,rootVisible:false,maxHeight:C.maxTreeHeight,shadow:false,manageHeight:false,listeners:{itemclick:Ext.bind(C.onItemClick,C)},viewConfig:{listeners:{render:function(D){D.getEl().on("keypress",C.onPickerKeypress,C)}}}}),A=B.getView();A.on("render",C.setPickerViewStyles,C);if(Ext.isIE9&&Ext.isStrict){A.on("highlightitem",C.repaintPickerView,C);A.on("unhighlightitem",C.repaintPickerView,C);A.on("afteritemexpand",C.repaintPickerView,C);A.on("afteritemcollapse",C.repaintPickerView,C)}return B},setPickerViewStyles:function(A){A.getEl().setStyle({"min-height":this.minPickerHeight+"px","max-height":this.maxPickerHeight+"px"})},repaintPickerView:function(){var A=this.picker.getView().getEl().dom.style;A.display=A.display},alignPicker:function(){var B=this,A;if(B.isExpanded){A=B.getPicker();if(B.matchFieldWidth){A.setWidth(B.bodyEl.getWidth())}if(A.isFloating()){B.doAlign()}}},onItemClick:function(E,A,B,D,C){this.selectItem(A)},onPickerKeypress:function(C,B){var A=C.getKey();if(A===C.ENTER||(A===C.TAB&&this.selectOnTab)){this.selectItem(this.picker.getSelectionModel().getSelection()[0])}},selectItem:function(A){var B=this;B.setValue(A.data);B.picker.hide();B.inputEl.focus();B.fireEvent("select",B,A)},onExpand:function(){var D=this,C=D.picker,B=C.store,A=D.value;if(A.id){C.selectPath(B.getNodeById(A.id).getPath())}else{C.getSelectionModel().select(B.getRootNode())}Ext.defer(function(){C.getView().focus()},1)},setValue:function(B){var A=this;if(A.store.loading){return A}A.value=B;A.setRawValue(B?B.name:"");return A},getValue:function(){return this.value},onLoad:function(){var A=this.value;if(A){this.setValue(A)}}});